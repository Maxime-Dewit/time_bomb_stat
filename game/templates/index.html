{% extends 'base.html' %}

{% block content %}
<h1>Time Bomb — Accueil</h1>

<div class="card">
  <h3>Créer une partie (deviens maître)</h3>
  <form method="post" action="/create_game/">{% csrf_token %}
    <input name="master" list="players-list" placeholder="Nom maître (optionnel)">
    <button type="submit">Créer partie</button>
  </form>
</div>

<div class="card">
  <h3>Parties récentes</h3>
  <ul>
    {% for g in games %}
      <li>
        Partie {{ g.id }} — Maître: {{ g.master }} — Démarrée: {{ g.started_at }} — Terminée: {{ g.ended_at }}
        {% if not g.started_at and not g.ended_at %}
          <form style="display:inline" method="post" action="/manage/{{ g.id }}/">{% csrf_token %}
            <button type="submit">Démarrer</button>
          </form>
        {% endif %}
        {% if g.started_at and not g.ended_at %}
          <form style="display:inline" method="post" action="/manage/{{ g.id }}/">{% csrf_token %}
            <button type="submit">Reprendre</button>
          </form>
        {% endif %}
          {% if g.ended_at %}
            (Rôle gagnant: {{ g.winner_role }})
          {% endif %}
         <br>
         Participants: 
         {% for p in g.participations.all %}
           {{ p.player.name }} ({{ p.get_role_display }}){% if p.get_info_display %} [{{ p.get_info_display }}]{% endif %}{% if not forloop.last %}, {% endif %}
         {% empty %}
           Aucun participant
         {% endfor %}
         <br>
        <form style="display:inline" method="get" action="/game/{{ g.id }}/">
          <button type="submit">Infos</button>
        </form>
        {% if g.ended_at %}
        <form style="display:inline" method="post" action="/rematch/{{ g.id }}/">{% csrf_token %}
          <button type="submit">Refaire une partie</button>
        </form>
        {% endif %}
      </li>
    {% empty %}
      <li>Aucune partie</li>
    {% endfor %}
  </ul>
</div>

<!-- datalist for existing players to ease selection in forms -->
<datalist id="players-list">
  {% for p in players %}
    <option value="{{ p.name }}"></option>
  {% endfor %}
</datalist>

{% endblock %}
